{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<h2 class="page-title">ë°°ì¶” ìƒì‚°ëŸ‰ ì˜ˆì¸¡í•˜ê¸°</h2>

<!-- ğŸ” í•„í„° í¼ (ì‹œë„â€§ì—°ë„â€§ì§ˆì†Œ) -->
<form method="get" id="filter-form">
    <div class="filter-box">

    <!-- ì‹œë„ ë‹¨ì¼ ì„ íƒ -->
    <div class="sido-checkboxes">
        {% for sido in sido_list %}
            <label>
            <input type="checkbox" class="sido-check"
                    name="sido" value="{{ sido }}"
                    {% if sido == selected_sido %}checked{% endif %}>
            {{ sido }}
            </label>
        {% endfor %}
    </div>

    <hr class="filter-divider">

    <!-- ì—°ë„ ë‹¨ì¼ ì„ íƒ -->
    <div class="year-filter-row">
        {% for year in year_list %}
            <label>
            <input type="checkbox" class="year-check"
                    name="year" value="{{ year }}"
                    {% if year|stringformat:"s" == selected_year %}checked{% endif %}>
            {{ year }}
            </label>
        {% endfor %}
    </div>

    <hr class="filter-divider">

    <!-- ì§ˆì†Œ ì…ë ¥ + ê²€ìƒ‰ ë²„íŠ¼ -->
    <div class="nitrogen-filter-row">
        <input type="number" name="nitrogen"
                step="1" min="0"
                class="nitrogen-input"
                placeholder="ì§ˆì†Œê°’ (ì˜ˆ: 20)"
                value="{{ nitrogen|default:'' }}">
        <button type="submit" class="inline-search-button">ê²€ìƒ‰</button>
        </div>
    </div>
</form>

<!-- ê²°ê³¼ í…Œì´ë¸” (í¼ ë°–) -->
<table class="weatherforecast-table">
    <thead>
        <tr>
        <th>í‰ê· ê¸°ì˜¨ (â„ƒ)</th>
        <th>í‰ê· ìŠµë„ (%)</th>
        <th>í‰ê· í’ì† (m/s)</th>
        <th>í‰ê· ì¼ì‚¬ëŸ‰ (MJ/ã¡)</th>
        <th>í‰ê· ê°•ìˆ˜ëŸ‰ (mm)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
        <td>{{ weather_stats.avg_temp }}</td>
        <td>{{ weather_stats.humidity }}</td>
        <td>{{ weather_stats.wind_speed }}</td>
        <td>{{ weather_stats.solar_radiation }}</td>
        <td>{{ weather_stats.avg_precipitation }}</td>
        </tr>
    </tbody>
</table>

<!-- ğŸ”» ì˜ˆì¸¡ ê²°ê³¼ í…Œì´ë¸” -->
<table class="prediction-result-table">
    <thead>
        <tr>
            <th>ì˜ˆì¸¡ê°’</th>
            <th>ì‹¤ì œê°’</th>
            <th>ì˜¤ì°¨ìœ¨ (%)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ prediction|default:"-" }}</td>
            <td>{{ actual|default:"-" }}</td>
            <td>{{ error_rate|default:"-" }}</td>
        </tr>
    </tbody>
</table>


<!-- âœ… ë‹¨ì¼ ì„ íƒ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // í•˜ë‚˜ë§Œ ì„ íƒë˜ë„ë¡ ì œì–´
    document.querySelectorAll('.sido-check').forEach(cb => {
        cb.addEventListener('change', () => {
        if (cb.checked) {
            document.querySelectorAll('.sido-check').forEach(o => { if (o !== cb) o.checked = false; });
        }
        });
    });
    document.querySelectorAll('.year-check').forEach(cb => {
        cb.addEventListener('change', () => {
        if (cb.checked) {
            document.querySelectorAll('.year-check').forEach(o => { if (o !== cb) o.checked = false; });
        }
        });
    });
});

// ìƒˆë¡œê³ ì¹¨(F5) ì‹œ íŒŒë¼ë¯¸í„° ì œê±°í•´ ì´ˆê¸°í™”
window.addEventListener('pageshow', e => {
    if (e.persisted || (performance && performance.navigation.type === 1)) {
    window.location.replace('/cabbageforecast/');
    }
});
</script>
{% endblock %}
