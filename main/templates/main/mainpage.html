{% extends 'base.html' %}
{% load static %}

{% block content %}
<form method="get">
    <!-- ğŸ” ê²€ìƒ‰ì°½ ì»¨í…Œì´ë„ˆ -->
    <div class="top-section">
        <label for="sido">ì‹œÂ·ë„ ì„ íƒ :</label>
        <select id="sido" name="sido">
            <option value="">ì‹œÂ·ë„ ì„ íƒ</option>
            <!-- íŠ¹ë³„ì‹œ ë° ê´‘ì—­ì‹œ ë¨¼ì € -->
            <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
            <option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
            <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
            <option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</option>
            <option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
            <option value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
            <option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
            <option value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</option>

            <!-- ë„(é“) ë‹¨ìœ„ -->
            <option value="ê°•ì›ë„">ê°•ì›ë„</option>
            <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
            <option value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</option>
            <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
            <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
            <option value="ì „ë¼ë¶ë„">ì „ë¼ë¶ë„</option>
            <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
            <option value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</option>

            <!-- íŠ¹ë³„ìì¹˜ë„ -->
            <option value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
        </select>

        <label for="sigungu">ì‹œÂ·êµ°Â·êµ¬ ì„ íƒ :</label>
        <select id="sigungu" name="sigungu">
            <option value="">ì‹œÂ·êµ°Â·êµ¬ ì„ íƒ</option>
        </select>

        <label for="eupmyeondong">ìÂ·ë©´Â·ë™ ì„ íƒ :</label>
        <select id="eupmyeondong" name="eupmyeondong">
            <option value="">ìÂ·ë©´Â·ë™ ì„ íƒ</option>
        </select>

        <button type="submit" class="search-button">
            <img src="{% static 'images/Search-icon.svg' %}" alt="ê²€ìƒ‰">
        </button>
        
    </div>
</form>
    <!-- ğŸ“Š ë°ì´í„° ë°•ìŠ¤ & ì§€ë„ ì»¨í…Œì´ë„ˆ -->
    <div class="bottom-section">
        <div class="data-container">
            <div class="leftdata-container">
                <div class="topdata1-container">
                    <p class="topdata1-text">ê¸°ìƒ ë°ì´í„°</p>
                </div>
                <div class="bottomdata1-container">
                    <div class="weather-row">
                        <img src="{% static 'images/T1-icon.svg' %}" alt="ì˜¨ë„" class="weather-icon">
                        <div class="weather-text">
                            <p>ìµœì €ì˜¨ë„ : 
                                <a href="{% url 'main:weatherpage' %}">
                                {{ weather.min_temp }}Â°C
                                </a>
                            </p>
                            <p>ìµœê³ ì˜¨ë„ : {{ weather.max_temp }}Â°C</p>
                        </div>
                    </div>
                
                    <div class="weather-row">
                        <img src="{% static 'images/T2-icon.svg' %}" alt="ìŠµë„" class="weather-icon">
                        <p class="weather-text">ìŠµë„ : {{ weather.humidity }}%</p>
                    </div>
                
                    <div class="weather-row">
                        <img src="{% static 'images/T3-icon.svg' %}" alt="í’ì†" class="weather-icon">
                        <p class="weather-text">í’ì† : {{ weather.wind_speed }}m/s</p>
                    </div>
                
                    <div class="weather-row">
                        <img src="{% static 'images/T4-icon.svg' %}" alt="ì¼ì‚¬ëŸ‰" class="weather-icon">
                        <p class="weather-text">ì¼ì‚¬ëŸ‰ : {{ weather.solar_radiation }}</p>
                    </div>
                
                    <div class="weather-row">
                        <img src="{% static 'images/T5-icon.svg' %}" alt="ê°•ìˆ˜ëŸ‰" class="weather-icon">
                        <p class="weather-text">ê°•ìˆ˜ëŸ‰ : {{ weather.avg_precipitation }}mm</p>
                    </div>
                </div>
            </div>
        
            <!-- ğŸ”½ ì•„ë˜ìª½ ë°ì´í„° ì»¨í…Œì´ë„ˆ -->
            <div class="rightdata-container">
                <div class="topdata2-container">
                    <p class="topdata2-text">í† ì–‘ ë°ì´í„°</p>
                </div>
                <div class="bottomdata2-container">
                    <p class="soil-text">í† ìƒ‰ :</p>
                    <p class="soil-text">ì‚°ë„(PH) :</p>
                    <p class="soil-text">ìœ ê¸°ë¬¼ :</p>
                    <p class="soil-text">ìœ íš¨ì¸ì‚° :</p>
                    <p class="soil-text">ì¹¼ë¥¨ :</p>
                    <p class="soil-text">ì¹¼ìŠ˜ :</p>
                    <p class="soil-text">ë§ˆê·¸ë„¤ìŠ˜ :</p>
                </div>
            </div>
        </div>
        <div class="map-container">
            <div id="map"></div>
        </div>
<script>
    // views.pyì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°
    const regionData = JSON.parse('{{ region_json|escapejs }}');
    const emdData = JSON.parse('{{ emd_json|escapejs }}');  // ìë©´ë™ ë°ì´í„° ì¶”ê°€
    
    // ì‹œÂ·ë„ ì„ íƒì‹œ ì‹œêµ°êµ¬ ì±„ìš°ê¸°
    document.getElementById('sido').addEventListener('change', function() {
        const selectedSido = this.value;
        const sigunguSelect = document.getElementById('sigungu');
        sigunguSelect.innerHTML = '<option value="">ì‹œÂ·êµ°Â·êµ¬ ì„ íƒ</option>';
    
        if (selectedSido && regionData[selectedSido]) {
            regionData[selectedSido].forEach(function(sigungu) {
                const option = document.createElement('option');
                option.value = sigungu;
                option.textContent = sigungu;
                sigunguSelect.appendChild(option);
            });
        }
    
        // ìë©´ë™ ì´ˆê¸°í™”
        document.getElementById('eupmyeondong').innerHTML = '<option value="">ìÂ·ë©´Â·ë™ ì„ íƒ</option>';
    });
    
    // ì‹œÂ·êµ°Â·êµ¬ ì„ íƒì‹œ ìë©´ë™ ì±„ìš°ê¸°
    document.getElementById('sigungu').addEventListener('change', function() {
        const selectedSigungu = this.value;
        const eupmyeondongSelect = document.getElementById('eupmyeondong');
        eupmyeondongSelect.innerHTML = '<option value="">ìÂ·ë©´Â·ë™ ì„ íƒ</option>';
    
        if (selectedSigungu && emdData[selectedSigungu]) {
            emdData[selectedSigungu].forEach(function(emd) {
                const option = document.createElement('option');
                option.value = emd;
                option.textContent = emd;
                eupmyeondongSelect.appendChild(option);
            });
        }
    });
</script>
<!-- ì¹´ì¹´ì˜¤ ì§€ë„ API ì¶”ê°€ -->
<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey={{ kakao_api_key }}"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var latitude = parseFloat("{{ latitude }}");
        var longitude = parseFloat("{{ longitude }}");

        var mapContainer = document.getElementById('map'),
            mapOption = {
                center: new kakao.maps.LatLng(latitude, longitude), // ìœ„ë„, ê²½ë„
                level: 13 // í™•ëŒ€ ë ˆë²¨
            };

        var map = new kakao.maps.Map(mapContainer, mapOption);

        // ë§ˆì»¤ ì„¤ì •
        var markerPosition = new kakao.maps.LatLng(latitude, longitude);
        var marker = new kakao.maps.Marker({
            position: markerPosition
        });

        // ë§ˆì»¤ ì§€ë„ì— ì¶”ê°€
        marker.setMap(map);
    });
</script>
{% endblock %}
